<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>
        Pomelo
    </title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta http-equiv="content-style-type" content="text/css" />
    <meta http-equiv="content-scripte-type" content="text/javascript" />
    <meta name="author" content="netease" />
    <meta name="version" content="1.0" />
    <meta name="keywords" content="pomelo" />
    <link type="text/css" rel="stylesheet" href="../css/base.css" />
    <link type="text/css" rel="stylesheet" href="../layer/skin/layer.css" />
    <script src="../js/lib/build/build.js" type="text/javascript"></script>
    <script src="../jquery.js" type="text/javascript"></script>
    <script src="../jquery.cookie.js" type="text/javascript"></script>
    <script src="../layer/layer.js" type="text/javascript"></script>
    <script type="text/javascript">
        require('boot');
    </script>
    <script type="text/javascript">
        var pomelo = window.pomelo;
                var host = "121.40.53.201";
//        var host = '192.168.2.123';
        var port = "3015";

        $(document).ready(function() {
            pomelo.on('onMsg', function (data) {
                layer.alert("xxxxx::" + JSON.stringify(data));
            });


            var cookieToken = $.cookie('token');
            if(cookieToken == null || cookieToken == undefined) {

            } else {
                pomelo.init({host:host, port:port, log:true}, function() {
                    var route = 'user.entryHandler.auth';
                    pomelo.request(route, {token:cookieToken}, function(data) {
                        if(data === 1001) {
                            layer.msg('验证失败');
                        } else {
                            layer.msg('验证成功');
                            showNoticeList();
                        }
                    });
                });
            }
        });
        [{"_id":"57bd48481dbbfdd0263f48cf","userMobile":"13600000008",
            "hasRead":0,"title":"橙色大风报警Wed Aug 24 2016 15:10:00 GMT+0800 (CST)",
            "content":"6小时内可能受大风影响,平均风力可达10级以上，" +
            "或阵风11级以上；或者已经受大风影响, 平均风力为10—11级，或阵风11—12级并可能持续。","noticeType":2,"addTime":"2016-08-24T07:10:00.000Z"}
        function showNoticeList() {
            pomelo.request("user.userHandler.getNoticeList", {page:1, pageSize:15}, function(data) {
                for(var i=0; i<data.data.length;i++) {
                    layer.alert(JSON.stringify(data));
                    var html = "<div>" + data.data[i].title + "<input type='button' onclick='read(\"" + data.data[i]._id + "\");' value='阅读'></div>";
                    $("#container").append(html);
                }
            });
        }

        function read(noticeId) {
            pomelo.request('user.userHandler.setNoticeRead', {noticeId:noticeId}, function(data) {
                window.location.reload();
            });
        }

        function getCount() {
            pomelo.request('user.userHandler.getNoticeNotReadCount', {}, function(data) {
                layer.alert(JSON.stringify(data));
            });
        }
    </script>
</head>
<body>
<input type="button" value="数量" onclick="getCount();" />
    <div id="container">

    </div>
</body>
</html>
